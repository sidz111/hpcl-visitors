<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8" />
<title>Manasvi Inventory</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport" />
<meta content="" name="keywords" />
<meta content="" name="description" />

<!-- Favicon -->
<link href="images/fevicon.png" rel="icon" />

<!-- Google Web Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap"
	rel="stylesheet" />

<!-- Icon Font Stylesheet -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
	rel="stylesheet" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
	rel="stylesheet" />

<!-- Libraries Stylesheet -->
<link href="lib/owlcarousel/assets/owl.carousel.min.css"
	rel="stylesheet" />
<link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
	rel="stylesheet" />

<!-- Customized Bootstrap Stylesheet -->
<link href="css/bootstrap.min.css" rel="stylesheet" />

<!-- Template Stylesheet -->
<link href="css/style.css" rel="stylesheet" />

<style>
body {
	font-family: Arial, sans-serif;
	margin: 0;
	padding: 0;
	display: flex;
	justify-content: center;
	align-items: center;
	min-height: 100vh;
	background-color: #f4f4f4;
}

.visitor-slip {
	width: 100%;
	max-width: 900px;
	margin: 20px auto;
	padding: 20px;
	border: 2px solid #000;
	box-sizing: border-box;
	position: relative;
}

.visitor-slip-header {
	text-align: center;
	margin-bottom: 10px;
}

.visitor-slip-header p {
	font-size: 14px;
	margin: 0;
	line-height: 1.2;
}

.visitor-slip-header img.left-logo {
	position: absolute;
	top: 10px;
	left: 10px;
	width: 9%;
	height: auto;
}

.visitor-slip-header img.right-logo {
	position: absolute;
	top: 10px;
	right: 10px;
	width: 50px;
	height: auto;
}

.visitor-slip-title-section {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 10px;
}

.visitor-slip-title-section div {
	flex: 1;
}

.visitor-slip-title-section div:first-child p,
	.visitor-slip-title-section div:last-child p {
	font-size: 14px;
	margin: 0;
}

.visitor-slip-title-section div:nth-child(2) {
	text-align: center;
}

.visitor-slip-title-section div:nth-child(2) p {
	font-size: 16px;
	font-weight: bold;
	margin: 0;
}

.visitor-slip-title-section div:last-child {
	text-align: right;
}

.visitor-slip-green-bar {
	background-color: #008000;
	height: 20px;
	margin-bottom: 10px;
	text-align: center;
	color: white;
}

.visitor-slip-details {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	margin-bottom: 10px;
}

.visitor-slip-details .form-group {
	flex: 1;
	min-width: 200px;
}

.visitor-slip-details .form-group label {
	font-size: 14px;
	font-weight: bold;
	margin-bottom: 5px;
	display: block;
}

.visitor-slip-details .form-group input {
	width: 100%;
	padding: 5px;
	border: none;
	border-bottom: 1px solid #000;
	font-size: 14px;
	box-sizing: border-box;
}

.visitor-slip-signatures {
	display: flex;
	justify-content: space-between;
	margin-bottom: 10px;
	border: 1px solid #000;
	padding: 10px;
}

.visitor-slip-signatures div {
	flex: 1;
	text-align: center;
}

.visitor-slip-signatures div p {
	font-size: 14px;
	font-weight: bold;
	margin: 0 0 5px;
}

.visitor-slip-signatures div input {
	width: 100%;
	padding: 5px;
	border: none;
	border-bottom: 1px solid #000;
	font-size: 14px;
	text-align: center;
	box-sizing: border-box;
}

.visitor-slip-red-bar {
	background-color: #ff0000;
	height: 20px;
	margin-bottom: 10px;
	text-align: center;
	color: white;
}

.visitor-slip-safety {
	border: 1px solid #000;
	padding: 10px;
	margin-bottom: 10px;
}

.visitor-slip-safety p {
	font-size: 12px;
	margin: 0;
	text-align: center;
}

.visitor-slip-signatures-bottom {
	display: flex;
	justify-content: space-between;
	margin-bottom: 10px;
}

.visitor-slip-signatures-bottom div {
	flex: 1;
	text-align: center;
}

.visitor-slip-signatures-bottom div p {
	font-size: 14px;
	font-weight: bold;
	margin: 0 0 5px;
}

.visitor-slip-signatures-bottom div input {
	width: 100%;
	padding: 5px;
	border: none;
	border-bottom: 1px solid #000;
	font-size: 14px;
	text-align: center;
	box-sizing: border-box;
}

.visitor-slip-footer {
	display: flex;
	justify-content: space-between;
	border: 1px solid #ff0000;
	padding: 10px;
}

.visitor-slip-footer div {
	flex: 1;
}

.visitor-slip-footer div p {
	font-size: 12px;
	margin: 0;
	line-height: 1.2;
}

.visitor-slip-footer div:first-child p {
	font-weight: bold;
}

.visitor-slip-footer div:last-child {
	border-left: 1px solid #ff0000;
	padding-left: 10px;
}

.visitor-slip-footer div:last-child p {
	font-weight: bold;
}

.visitor-slip-buttons {
	display: flex;
	justify-content: center;
	gap: 10px;
	margin-top: 10px;
}

.visitor-slip-buttons button {
	padding: 10px 20px;
	font-size: 14px;
}

.visitor-slip-buttons .print-btn {
	background-color: #008000;
	color: white;
	border: none;
}

.visitor-slip-buttons .back-btn {
	background-color: #007bff;
	color: white;
	border: none;
}

.visitor-slip-additional-details {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
	margin-bottom: 10px;
}

.visitor-slip-additional-details .form-group {
	flex: 1;
	min-width: 200px;
}

.visitor-slip-additional-details .form-group label {
	font-size: 14px;
	font-weight: bold;
	margin-bottom: 5px;
	display: block;
}

.visitor-slip-additional-details .form-group input {
	width: 100%;
	padding: 5px;
	border: none;
	border-bottom: 1px solid #000;
	font-size: 14px;
	box-sizing: border-box;
}
/* Styles for PDF viewer */
.pdf-modal {
	display: none;
	position: fixed;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	width: 80%;
	max-width: 900px;
	height: 80%;
	background: white;
	border: 2px solid #000;
	z-index: 1000;
	overflow: auto;
}

.pdf-modal iframe {
	width: 100%;
	height: 100%;
	border: none;
}

.overlay {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.5);
	z-index: 999;
}

@media ( max-width : 600px) {
	.visitor-slip {
		padding: 10px;
	}
	.visitor-slip-details .form-group, .visitor-slip-additional-details .form-group
		{
		min-width: 100%;
	}
	.visitor-slip-signatures, .visitor-slip-signatures-bottom,
		.visitor-slip-footer {
		flex-direction: column;
		text-align: center;
	}
	.visitor-slip-signatures div, .visitor-slip-signatures-bottom div,
		.visitor-slip-footer div {
		margin-bottom: 10px;
	}
	.visitor-slip-footer div:last-child {
		border-left: none;
		padding-left: 0;
		border-top: 1px solid #ff0000;
		padding-top: 10px;
	}
	.visitor-slip-header img.left-logo, .visitor-slip-header img.right-logo
		{
		width: 40px;
	}
	.pdf-modal {
		width: 90%;
		height: 90%;
	}
}
</style>
</head>

<body>
	<div class="container-fluid  d-flex p-0">
		<!-- Spinner Start -->
		<div id="spinner"
			class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
			<div class="spinner-border text-primary"
				style="width: 3rem; height: 3rem" role="status">
				<span class="sr-only">Loading...</span>
			</div>
		</div>
		<!-- Spinner End -->

		<!-- Sidebar Start -->
		<div class="sidebar pe-4 pb-3">
			<nav class="navbar bg-white text-dark">
				<a href="/" class="navbar-brand mx-4 mb-3">
					<h3 class="text-primary">
						<img class="" src="images/hpcl.jpeg" alt=""
							style="width: 100%; height: 60%" />
					</h3>
				</a>

				<div class="navbar-nav w-100">
					<a href="/" class="nav-item nav-link"><i
						class="fa fa-home fs-4 me-2"></i>Dashboard</a>

					<div class="nav-item dropdown">
						<a href="#" class="nav-link dropdown-toggle"
							data-bs-toggle="dropdown"><i class="fas fa-users fs-4 me-2"></i>Visitors</a>
						<div class="dropdown-menu bg-transparent border-0">
							<a href="/visitor/add" class="dropdown-item">Add Visitor</a>
						</div>
					</div>

				</div>
			</nav>

			<!-- Logout Button -->
			<div class="logout-btn-container">
				<a href="/logout"
					class="btn logout-btn fw-bold px-3 py-2 fs-5 shadow"> <i
					class="fas fa-sign-out-alt me-2"></i> Logout
				</a>
			</div>

		</div>

		<!-- Sidebar End -->

		<!-- Content Start -->
		<div class="content">
			<!-- Navbar Start -->
			<nav class="navbar navbar-expand navbar-dark sticky-top px-4 py-0"
				style="background-color: #008bf9;">
				<a href="#" class="sidebar-toggler flex-shrink-0"> <i
					class="fa fa-bars"></i>
				</a>
				<h2 class="ms-5 text-blue">HPCL Visitors Module</h2>
				<div class="navbar-nav align-items-center ms-auto">
					<div class="nav-item dropdown">
						<a href="#" class="nav-link dropdown-toggle"
							data-bs-toggle="dropdown"> <i
							class="text-danger fa fa-bell me-lg-2"></i> <span
							class="d-none d-lg-inline-flex">Notification</span>
						</a>

						<div
							class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0 p-3">
						</div>
					</div>



				</div>
			</nav>


			<div class="visitor-slip">
				<div class="visitor-slip-header">
					<img th:src="@{'/gate-pass/' + ${gatePass.photo}}" alt="Left Logo"
						class="left-logo" />
					<p>Hindustan Petroleum Corporation Limited</p>
					<p>Sion LPG Bottling Plant, G-6, MIDC, Malegaon, Maharashtra
						422213 GSTIN: 27AAACH1088B1ZC</p>
					<p>Visitor Slip</p>
					<img src="qr-9e5843671f3cc028759d5660d9520d32.png" alt="Right Logo"
						class="right-logo" />
				</div>
				<div class="visitor-slip-title-section">
					<div>
						<p>
							तारीख (Date): <span th:text="${gatePass.date}"></span>
						</p>
					</div>
					<div>
						<p>PATALGANGA LPG FILLING PLANT</p>
					</div>
					<div>
						<p>आगमन का समय (Arrival Time):_________</p>
						<p>प्रस्थान का समय (Departure Time)</p>
					</div>
				</div>
				<div class="visitor-slip-green-bar">केवल एडमिन क्षेत्र में
					प्रवेश के लिए</div>
				<div class="visitor-slip-details">
					<div class="form-group">
						<label>Sr No:</label> <input type="text" id="id" th:value="${gatePass.id}"
							readonly />
					</div>
					<div class="form-group">
						<label>१) आगंतुक का नाम</label> <input type="text" id="name"
							th:value="${gatePass.fullName}" readonly />
					</div>
					<div class="form-group">
						<label>२) कार्य स्थल (Location)</label> <input type="text" id="address"
							th:value="${gatePass.address}" readonly />
					</div>
					<div class="form-group">
						<label>३) आगंतुक का मोबाइल न.</label> <input type="text" id="contact"
							th:value="${gatePass.mobileNo}" pattern="[0-9]{10}"
							title="Please enter a 10-digit mobile number" readonly />
					</div>
					<div class="form-group">
						<label>४) पहचान पत्र न.</label> <input type="text" id="passId"
							th:value="${gatePass.gatePassNumber}" pattern="[0-9]{12}"
							title="Please enter a 12-digit ID number" readonly />
					</div>
					<div class="form-group">
						<label>५) मालिक/व्यवसाय का नाम</label> <input type="text"
							th:value="${gatePass.fullName}" readonly />
					</div>
					<div class="form-group">
						<label>६) उद्देश्य</label> <input type="text" id="purpose"
							th:value="${gatePass.purposeToVisit}" readonly />
					</div>
					<div class="form-group">
						<label>७) कंपनी का नाम (Company Name)</label> <input type="text"
							value="" required pattern="[A-Za-z\s]{1,50}"
							title="Please enter a valid company name (letters and spaces only, max 50 characters)" />
					</div>
					<div class="form-group">
						<label>८) वाहन नंबर (Vehicle Number)</label> <input type="text"
							value="" required pattern="[A-Za-z0-9]{1,10}"
							title="Please enter a valid vehicle number (max 10 characters)" />
					</div>
					<div class="form-group">
						<label>९) गाड़ी का प्रकार (Vehicle Type)</label> <input type="text"
							value="" required pattern="[A-Za-z\s]{1,20}"
							title="Please enter a valid vehicle type (letters and spaces only, max 20 characters)" />
					</div>
					<div class="form-group">
						<label>१०) ड्राइवर का नाम (Driver Name)</label> <input type="text"
							value="" required pattern="[A-Za-z\s]{1,50}"
							title="Please enter a valid driver name (letters and spaces only, max 50 characters)" />
					</div>
					<div class="form-group">
						<label>११) ड्राइवर का मोबाइल न. (Driver Mobile Number)</label> <input
							type="text" value="" required pattern="[0-9]{10}"
							title="Please enter a 10-digit mobile number" />
					</div>
					<div class="form-group">
						<label>१२) सामग्री का विवरण (Material Description)</label> <input
							type="text" value="" required pattern="[A-Za-z0-9\s]{1,100}"
							title="Please enter a valid material description (max 100 characters)" />
					</div>
					<div class="form-group">
						<label>१३) सामग्री की मात्रा (Material Quantity)</label> <input
							type="number" value="" required min="1"
							title="Please enter a valid quantity" />
					</div>
					<div class="form-group">
						<label>१४) लोडिंग/अनलोडिंग समय (Loading/Unloading Time)</label> <input
							type="text" value="" required pattern="[0-9]{2}:[0-9]{2}"
							title="Please enter time in HH:MM format" />
					</div>
				</div>
				<div class="visitor-slip-signatures">
					<div>
						<p>आगंतुक के हस्ताक्षर</p>
						<input type="text" value="Visitor Signature" readonly />
					</div>
					<div>
						<p>सुरक्षा के हस्ताक्षर</p>
						<input type="text" value="Security Signature" readonly />
					</div>
					<div>
						<p>प्राप्तकर्ता के हस्ताक्षर</p>
						<input type="text" value="Receiver Signature" readonly />
					</div>
				</div>
				<div class="visitor-slip-red-bar">लाइसेंस प्राप्त क्षेत्र में
					प्रवेश के लिए</div>
				<!-- Added missing fields for Licensed Area Entry -->
				<div class="visitor-slip-additional-details">
					<div class="form-group">
						<label>नाम:</label> <input type="text"
							th:value="${gatePass.fullName}" required
							pattern="[A-Za-z\s]{1,50}"
							title="Please enter a valid name (letters and spaces only, max 50 characters)" />
					</div>
					<div class="form-group">
						<label>हस्ताक्षर:</label> <input type="text" value="" required
							pattern="[A-Za-z\s]{1,50}"
							title="Please enter a valid signature (letters and spaces only, max 50 characters)" />
					</div>
					<div class="form-group">
						<label>उद्देश्य:</label> <input type="text"
							th:value="${gatePass.purposeToVisit}" required
							pattern="[A-Za-z\s]{1,50}"
							title="Please enter a valid purpose (letters and spaces only, max 50 characters)" />
					</div>
				</div>
				<div class="visitor-slip-safety">
					<p>I have been apprised about all safety precautions to be
						taken while in licensed area and which are also printed on the
						backside of visitor slip.</p>
					<p>मुझे लाइसेंस प्राप्त क्षेत्र में रहते समय सभी सुरक्षा
						सावधानियों के बारे में सूचित किया गया है जो आगंतुक पर्ची के पीछे
						भी मुद्रित हैं।</p>
				</div>
				<div class="visitor-slip-signatures-bottom">
					<div>
						<p>सुरक्षा के हस्ताक्षर</p>
						<input type="text" value="Security Signature" readonly />
					</div>
					<div>
						<p>आगंतुक के हस्ताक्षर</p>
						<input type="text" value="Visitor Signature" readonly />
					</div>
				</div>
				<div class="visitor-slip-footer">
					<div>
						<div class="visitor-slip-red-bar">
							<p>कृपया निम्न बातों को ध्यान रखें</p>
						</div>

						<ol>
							<li>1) सभी आगंतुकों को प्रवेश करने से पहले सुरक्षा जाँच से
								गुजरना होगा।</li>
							<li>2) मोबाइल फोन, कैमरा, इलेक्ट्रॉनिक डिवाइस, घड़ी आदि पर
								प्रतिबंध है।</li>
							<li>3) धूम्रपान, पान, गुटका, तंबाकू आदि पर पूर्णतया प्रतिबंध
								है।</li>
							<li>4) आगंतुकों को अपने साथ व्यक्तिगत सामान लाने की अनुमति
								नहीं है।</li>
							<li>5) सभी आगंतुकों को अपने मोबाइल फोन आदि जमा करना होगा।</li>
							<li>6) अज्ञात वस्तु, विस्फोटक, या संदिग्ध वस्तुओं को लाना
								मना है।</li>
							<li>7) अपनी नियुक्ति स्थल से बाहर न जाएं और किसी अन्य स्थान
								पर न जाएं।</li>
							<li>8) आपातकालीन स्थिति में सभी आगंतुकों को सभा बिंदु पर
								इकट्ठा होना चाहिए।</li>
						</ol>
					</div>
					<div>
						<div class="visitor-slip-red-bar">
							<p>PLEASE KEEP THIS POINTS IN MIND</p>
						</div>

						<ol>
							<li>1) Individuals are requested to take care of their
								safety.</li>
							<li>2) While entering the plant, please wear safety shoes
								and a helmet.</li>
							<li>3) Help in keeping the plant clean. Bringing pan masala
								and gutka into the plant is prohibited. Smoking is prohibited</li>
							<li>4) Entry into the plant requires permission and a pass.
								For this, please contact Security Gate No. 1.</li>
							<li>5) All visitors are requested to deposit their mobile
								phones or other electronic devices.</li>
							<li>6) If any unknown object, explosive, or suspicious items
								are found in the plant, please contact Security Gate No. 1.</li>
							<li>7) Do not leave your designated work area and go to any
								other location.</li>
							<li>8) In case of an emergency, all visitors should gather
								at the assembly point.</li>
						</ol>
					</div>
				</div>
				<div class="visitor-slip-buttons">
					<button class="print-btn">PRINT</button>
					<button class="back-btn">BACK</button>
				</div>
			</div>








			<div id="qrcode" class="qr-code-container"></div>
			<br />
			<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Extract gatePass data directly from Thymeleaf into a JS object
    const gatePass = {
        id: document.querySelector('#id')?.value || 'N/A',
        fullName: document.querySelector('#name')?.value || 'N/A',
        date: document.querySelector('#date')?.textContent || 'N/A', // Using textContent since it's a span
        address: document.querySelector('#address')?.value || 'N/A',
        mobileNo: document.querySelector('#contact')?.value || 'N/A',
        gatePassNumber: document.querySelector('#passId')?.value || 'N/A',
        purposeToVisit: document.querySelector('#purpose')?.value || 'N/A',
        // Add toSeeWhom if it exists in your HTML, otherwise remove it from qrData
        toSeeWhom: document.querySelector('#gatePassToSeeWhom')?.value || 'N/A' // Assuming an input with this ID
    };

    // Create QR code data string with actual values
    const qrData = `
        Visitor Pass Details:
        ID: ${gatePass.id}
        Name: ${gatePass.fullName}
        Date: ${gatePass.date}
        Mobile: ${gatePass.mobileNo}
        Address: ${gatePass.address}
        To See: ${gatePass.toSeeWhom}
        Purpose: ${gatePass.purposeToVisit}
    `.trim();

    // Generate QR code
    new QRCode(document.getElementById("qrcode"), {
        text: qrData,
        width: 200,
        height: 200,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });

    // Add click event to print button
    document.querySelector('.print-btn').addEventListener('click', function() {
        // Create a temporary print area
        const printContent = `
            <div class="visitor-slip">
                ${document.querySelector('.visitor-slip').innerHTML}
            </div>
            <div class="qr-code-container">
                ${document.getElementById('qrcode').innerHTML}
            </div>
        `;

        // Open a new window for printing
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
                <head>
                    <title>Print Visitor Slip</title>
                    <style>
                        /* Add your CSS here or link to your stylesheet */
                        .visitor-slip { /* Copy your existing CSS */ }
                        .qr-code-container { text-align: center; margin-top: 20px; }
                        @media print {
                            .visitor-slip-buttons { display: none; } /* Hide buttons when printing */
                        }
                    </style>
                </head>
                <body>
                    ${printContent}
                </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
    });
});
</script>






			<script>
let stream1, stream2;

// Start camera for visitor photo
function startVisitorCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            stream1 = stream;
            let video = document.getElementById('video');
            video.srcObject = stream;
            video.play();
        })
        .catch(err => console.log("Visitor camera error: " + err));
}

// Start camera for ID photo
function startIdCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            stream2 = stream;
            let video = document.getElementById('videoid');
            video.srcObject = stream;
            video.play();
        })
        .catch(err => console.log("ID camera error: " + err));
}

// Capture visitor photo
function capturePhoto() {
    let video = document.getElementById('video');
    let canvas = document.getElementById('canvas');
    let preview = document.getElementById('photo-preview');
    let context = canvas.getContext('2d');
    
    context.drawImage(video, 0, 0, 320, 240);
    let photoData = canvas.toDataURL('image/jpeg');
    
    document.getElementById('photo').value = photoData;
    preview.src = photoData;
    preview.style.display = 'block';
    canvas.style.display = 'none';
}

// Capture ID photo
function capturePhotoId() {
    let video = document.getElementById('videoid');
    let canvas = document.getElementById('canvasid');
    let preview = document.getElementById('id-photo-preview');
    let context = canvas.getContext('2d');
    
    context.drawImage(video, 0, 0, 320, 240);
    let photoData = canvas.toDataURL('image/jpeg');
    
    document.getElementById('idPhoto').value = photoData;
    preview.src = photoData;
    preview.style.display = 'block';
    canvas.style.display = 'none';
}

// Form validation
document.getElementById("visitorForm").addEventListener("submit", function(event) {
    let photoInput = document.getElementById("photo").value;
    let photoValidation = document.getElementById("photoValidation");
    let idPhotoInput = document.getElementById("idPhoto").value;
    let idPhotoValidation = document.getElementById("photoValidationid");

    if (!photoInput) {
        photoValidation.textContent = "Please capture visitor photo.";
        event.preventDefault();
    }
    
    if (!idPhotoInput) {
        idPhotoValidation.textContent = "Please capture ID photo.";
        event.preventDefault();
    }
});

// Initialize cameras on page load
window.onload = function() {
    startVisitorCamera();
    startIdCamera();
    
    // Set initial preview if exists (for editing)
    const photoInput = document.getElementById('photo');
    const idPhotoInput = document.getElementById('idPhoto');
    if (photoInput.value) {
        document.getElementById('photo-preview').src = photoInput.value;
        document.getElementById('photo-preview').style.display = 'block';
    }
    if (idPhotoInput.value) {
        document.getElementById('id-photo-preview').src = idPhotoInput.value;
        document.getElementById('id-photo-preview').style.display = 'block';
    }
};

// Cleanup on page unload
window.onunload = function() {
    if (stream1) stream1.getTracks().forEach(track => track.stop());
    if (stream2) stream2.getTracks().forEach(track => track.stop());
};
</script>




			<script>
				document.getElementById("stockForm").addEventListener("submit", function (event) {
					var stockItemId = document.getElementById("stockItem").value;
					var count = document.getElementById("count").value;

					if (!stockItemId || !count || count <= 0) {
						alert("Please select a stock item and enter a valid quantity.");
						event.preventDefault();
						return;
					}

					// Set the form action dynamically
					this.action = "/stock/use-stock/" + stockItemId + "/" + count;
				});
			</script>

			<script>
				const formatDate = (date) => {
					const year = date.getFullYear();
					const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
					const day = String(date.getDate()).padStart(2, '0');

					return `${year}-${month}-${day}`;
				};

				const currentDate = new Date();
				document.querySelector("#currentDate").innerHTML = formatDate(currentDate);
			</script>

			<script>
			
			
			document.getElementById("idcard-btn").addEventListener("click", function(event) {
    event.preventDefault(); // Prevent default form submission

    let formData = new FormData();
    
    // Get values from form fields
    formData.append("id", document.getElementById("id").value);
    formData.append("aadharNo", document.getElementById("aadhar_no").value);
    formData.append("fullName", document.getElementById("full_name").value);
    formData.append("mobileNo", document.getElementById("mobile_no").value);
    formData.append("address", document.getElementById("address").value);
    formData.append("toSeeWhom", document.getElementById("to_see_whom").value);
    formData.append("purposeToVisit", document.getElementById("purpose_to_visit").value);
    formData.append("isRegular", document.getElementById("is_regular").checked);

    // Get captured images in Base64
    let photoBase64 = document.getElementById("photo").value;
    let idPhotoBase64 = document.getElementById("idPhoto").value;

    // Append photos only if available
    if (photoBase64) {
        formData.append("photo", photoBase64);
    }
    if (idPhotoBase64) {
        formData.append("idPhoto", idPhotoBase64);
    }

    // Send data using AJAX to backend
    fetch("/generate-gate-pass", {
        method: "POST",
        body: formData
    })
    .then(response => {
        if (response.ok) {
            return response.text();
        }
        throw new Error("Failed to generate pass");
    })
    .then(data => {
        alert("Gate Pass Generated Successfully! 🎉");
        window.location.href = "/"; // Redirect after success
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Error generating Gate Pass. Please try again.");
    });
});
			</script>

			<!-- JavaScript Libraries -->
			<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
			<script
				src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
			<script src="lib/chart/chart.min.js"></script>
			<script src="lib/easing/easing.min.js"></script>
			<script src="lib/waypoints/waypoints.min.js"></script>
			<script src="lib/owlcarousel/owl.carousel.min.js"></script>
			<script src="lib/tempusdominus/js/moment.min.js"></script>
			<script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
			<script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
			<!-- Template Javascript -->
			<script src="/js/main.js"></script>
</body>
</html>